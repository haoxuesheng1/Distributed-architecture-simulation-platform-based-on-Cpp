# LevelDB åœ°å½¢æ•°æ®å­˜å‚¨å¼•æ“ä¼˜åŒ–

![C++](https://img.shields.io/badge/C++-17-blue.svg)
![LevelDB](https://img.shields.io/badge/LevelDB-1.23-green.svg)

è¯¥é¡¹ç›®æ˜¯ä¸€ä¸ªé’ˆå¯¹æµ·é‡åœ°å½¢æ•°æ®ä¼˜åŒ–çš„é«˜æ€§èƒ½å­˜å‚¨å¼•æ“ï¼ŒåŸºäºLevelDBæ„å»ºã€‚é€šè¿‡åˆ›æ–°çš„ç½‘æ ¼ç©ºé—´åˆ†åŒºç´¢å¼•å’Œçƒ­ç‚¹æ•°æ®ç¼“å­˜ç­–ç•¥ï¼Œå®ç°äº†äº¿çº§åœ°å½¢æ•°æ®çš„æ¯«ç§’çº§æŸ¥è¯¢ï¼Œç‰¹åˆ«é€‚åˆåœ°ç†ç©ºé—´æ•°æ®å¯†é›†å‹åº”ç”¨ã€‚

## æ ¸å¿ƒç‰¹æ€§

- ğŸŒ **ç½‘æ ¼ç©ºé—´åˆ†åŒºç´¢å¼•**ï¼šå°†åœ°ç†ç©ºé—´åˆ’åˆ†ä¸ºå‡åŒ€ç½‘æ ¼ï¼Œå®ç°é«˜æ•ˆæ•°æ®å®šä½
- ğŸ”¥ **çƒ­ç‚¹æ•°æ®ç¼“å­˜**ï¼šLRUç¼“å­˜ç­–ç•¥è‡ªåŠ¨ä¿ç•™é«˜é¢‘è®¿é—®æ•°æ®
- âš¡ **æ¯«ç§’çº§æŸ¥è¯¢**ï¼šçƒ­ç‚¹åŒºåŸŸæŸ¥è¯¢0mså“åº”
- ğŸš€ **é«˜æ€§èƒ½å†™å…¥**ï¼šæ”¯æŒæ‰¹é‡æ“ä½œï¼Œ68ä¸‡ç‚¹/ç§’çš„æ’å…¥é€Ÿç‡
- ğŸ” **é«˜æ•ˆèŒƒå›´æŸ¥è¯¢**ï¼š33,185ç‚¹æŸ¥è¯¢ä»…éœ€46ms
- ğŸ§© **æ¨¡å—åŒ–è®¾è®¡**ï¼šæ˜“äºé›†æˆåˆ°ç°æœ‰ç³»ç»Ÿ

## æ€§èƒ½æŒ‡æ ‡

| æ“ä½œç±»å‹ | æ•°æ®é‡ | è€—æ—¶ | é€Ÿç‡ |
|----------|--------|------|------|
| æ•°æ®æ’å…¥ | 100,000ç‚¹ | 147ms | 680,272ç‚¹/ç§’ |
| ç¼“å­˜å‘½ä¸­æŸ¥è¯¢ | 10,000æ¬¡ | 34ms | 294,117æ¬¡/ç§’ |
| å°èŒƒå›´æŸ¥è¯¢ | 1kmÂ² | 0ms | - |
| ä¸­èŒƒå›´æŸ¥è¯¢ | 100kmÂ² | 0ms | - |
| å¤§èŒƒå›´æŸ¥è¯¢ | 100Ã—100km | 46ms | - |
| çƒ­ç‚¹åŒºåŸŸæŸ¥è¯¢ | 14ç‚¹ | 0ms | - |

## å¿«é€Ÿå¼€å§‹

### ä¾èµ–é¡¹

- C++17 ç¼–è¯‘å™¨
- LevelDB (1.23 æˆ–æ›´é«˜ç‰ˆæœ¬)
- Google Test (ç”¨äºæµ‹è¯•)

### æ„å»ºé¡¹ç›®

```bash
# å…‹éš†ä»“åº“
git clone https://github.com/haoxuesheng1/Distributed-architecture-simulation-platform-based-on-Cpp.git
cd Distributed-architecture-simulation-platform-based-on-Cpp/levelDBmanager

# åˆ›å»ºæ„å»ºç›®å½•
mkdir build
cd build

# ç”Ÿæˆæ„å»ºç³»ç»Ÿ
cmake ..

# ç¼–è¯‘é¡¹ç›®
make
```

### è¿è¡Œæµ‹è¯•

```bash
./terrainStorageEngine_test
```

### ä½¿ç”¨ç¤ºä¾‹

```cpp
#include "TerrainStorageEngine.hpp"

int main() {
    // åˆå§‹åŒ–LevelDBç®¡ç†å™¨
    LevelDBManager& db_manager = LevelDBManager::getInstance();
    db_manager.initialize("/path/to/terrain_db");
    
    // åˆ›å»ºåœ°å½¢å­˜å‚¨å¼•æ“ï¼ˆåŒ—äº¬åœ°åŒºï¼‰
    TerrainStorageEngine terrain_store(
        db_manager,
        116.0, 39.0,   // æœ€å°ç»åº¦, æœ€å°çº¬åº¦
        117.5, 41.0,   // æœ€å¤§ç»åº¦, æœ€å¤§çº¬åº¦
        0.01,           // ç½‘æ ¼å¤§å°(çº¦1km)
        500             // ç¼“å­˜500ä¸ªç½‘æ ¼
    );
    
    // å­˜å‚¨åœ°å½¢ç‚¹
    terrain_store.put(116.405285, 39.904989, "43.5m");
    
    // æŸ¥è¯¢åœ°å½¢ç‚¹
    std::string elevation;
    if (terrain_store.get(116.405285, 39.904989, elevation)) {
        std::cout << "æµ·æ‹”é«˜åº¦: " << elevation << std::endl;
    }
    
    // æ‰¹é‡å­˜å‚¨
    std::vector<std::tuple<double, double, std::string>> batch_data;
    batch_data.emplace_back(116.406, 39.905, "42.8m");
    batch_data.emplace_back(116.407, 39.906, "41.3m");
    terrain_store.batchPut(batch_data);
    
    // èŒƒå›´æŸ¥è¯¢
    terrain_store.rangeQuery(
        116.40, 39.90,   // æœ€å°ç»åº¦, æœ€å°çº¬åº¦
        116.41, 39.91,   // æœ€å¤§ç»åº¦, æœ€å¤§çº¬åº¦
        [](double lon, double lat, const std::string& value) {
            std::cout << "ç‚¹(" << lon << "," << lat << "): " << value << std::endl;
        }
    );
    
    // é¢„åŠ è½½çƒ­ç‚¹åŒºåŸŸ
    terrain_store.preloadGrid("G_090_040");
    
    return 0;
}
```

## æ¶æ„è®¾è®¡

### æ ¸å¿ƒç»„ä»¶

1. **LevelDBManager**
   - LevelDBè¿æ¥çš„å•ä¾‹ç®¡ç†å™¨
   - å°è£…åŸºæœ¬æ“ä½œï¼ˆPut/Get/Deleteï¼‰
   - æä¾›æ‰¹é‡æ“ä½œå’Œè¿­ä»£å™¨æ¥å£

2. **TerrainStorageEngine**
   - åœ°å½¢æ•°æ®å­˜å‚¨å¼•æ“æ ¸å¿ƒ
   - å®ç°ç½‘æ ¼ç©ºé—´åˆ†åŒºç´¢å¼•
   - ç®¡ç†çƒ­ç‚¹æ•°æ®ç¼“å­˜
   - æä¾›é«˜æ•ˆèŒƒå›´æŸ¥è¯¢

3. **GridLRUCache**
   - ç½‘æ ¼æ•°æ®LRUç¼“å­˜å®ç°
   - è‡ªåŠ¨æ·˜æ±°æœ€å°‘ä½¿ç”¨çš„ç½‘æ ¼
   - æ”¯æŒæ‰‹åŠ¨ç¼“å­˜ç®¡ç†

### ä¼˜åŒ–ç­–ç•¥

1. **é”®å€¼ç»“æ„ä¼˜åŒ–**
   ```
   [ç½‘æ ¼ID]|[ç»åº¦]|[çº¬åº¦]
   ç¤ºä¾‹: G_090_040|116.4052850|39.9049890
   ```

2. **ç½‘æ ¼ç©ºé—´åˆ†åŒº**
   - åœ°ç†ç©ºé—´åˆ’åˆ†ä¸ºå‡åŒ€ç½‘æ ¼
   - æ¯ä¸ªç½‘æ ¼ç‹¬ç«‹å­˜å‚¨å’Œç¼“å­˜
   - æŸ¥è¯¢æ—¶ä»…åŠ è½½ç›¸å…³ç½‘æ ¼

3. **çƒ­ç‚¹æ•°æ®ç¼“å­˜**
   - LRUè‡ªåŠ¨ç®¡ç†é«˜é¢‘è®¿é—®ç½‘æ ¼
   - æ”¯æŒæ‰‹åŠ¨é¢„åŠ è½½çƒ­ç‚¹åŒºåŸŸ
   - ç¼“å­˜å¤±æ•ˆè‡ªåŠ¨æ›´æ–°

## åº”ç”¨åœºæ™¯

- åœ°ç†ä¿¡æ¯ç³»ç»Ÿï¼ˆGISï¼‰
- é¥æ„Ÿæ•°æ®å¤„ç†å¹³å°
- ä¸‰ç»´åœ°å½¢æ¸²æŸ“å¼•æ“
- æ™ºæ…§åŸå¸‚ç©ºé—´æ•°æ®ç®¡ç†
- å†›äº‹ä»¿çœŸåœ°å½¢æ•°æ®æœåŠ¡


## è‡´è°¢

- LevelDB å›¢é˜Ÿæä¾›å‡ºè‰²çš„é”®å€¼å­˜å‚¨å¼•æ“
- Google Test æä¾›å¼ºå¤§çš„æµ‹è¯•æ¡†æ¶æ”¯æŒ
- å›½å®¶è‡ªç„¶ç§‘å­¦åŸºé‡‘æä¾›ç ”ç©¶æ”¯æŒ

---

**è®©æµ·é‡åœ°å½¢æ•°æ®æŸ¥è¯¢é£èµ·æ¥ï¼** ğŸš€
